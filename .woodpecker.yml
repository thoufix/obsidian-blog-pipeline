clone:
  git:
    image: woodpeckerci/plugin-git:latest
    settings:
      recursive: false
      depth: 0

steps:
  - name: normalize-images
    image: python:3.11
    commands:
      - python scripts/images.py

  - name: build
    image: ghcr.io/gohugoio/hugo:latest
    commands:
      - git config --global --add safe.directory '*'
      - git submodule init
      - git submodule update --recursive || (cd hugo-site/themes/terminal && git fetch --all && git checkout cb9d8b0c9cfae43b4f82f146f7a9af332d6e47d8)
      - cd hugo-site
      - hugo --minify

  - name: deploy
    image: alpine:latest
    volumes:
      - /srv/blog:/srv/blog
    commands:
      - rm -rf /srv/blog/public/*
      - cp -r hugo-site/public/* /srv/blog/public/
